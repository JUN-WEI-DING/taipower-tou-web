# è‡ºé›»æ™‚é–“é›»åƒ¹æ¯”è¼ƒç¶²ç«™ - æŠ€è¡“è¦æ ¼æ›¸
## Taipower TOU Comparison Website - Technical Specification Document

---

**Version:** 1.0.0
**Date:** 2025-02-21
**Status:** Draft
**Author:** Technical Specification Team

---

## Table of Contents

1. [å°ˆæ¡ˆæ¦‚è¿° (Project Overview)](#1-å°ˆæ¡ˆæ¦‚è¿°-project-overview)
2. [ç›®æ¨™èˆ‡ç¯„åœ (Goals and Scope)](#2-ç›®æ¨™èˆ‡ç¯„åœ-goals-and-scope)
3. [æŠ€è¡“æ¶æ§‹ (Technical Architecture)](#3-æŠ€è¡“æ¶æ§‹-technical-architecture)
4. [åŠŸèƒ½éœ€æ±‚ (Functional Requirements)](#4-åŠŸèƒ½éœ€æ±‚-functional-requirements)
5. [éåŠŸèƒ½éœ€æ±‚ (Non-Functional Requirements)](#5-éåŠŸèƒ½éœ€æ±‚-non-functional-requirements)
6. [è³‡æ–™æ¨¡å‹ (Data Models)](#6-è³‡æ–™æ¨¡å‹-data-models)
7. [æ ¸å¿ƒæ¨¡çµ„è¨­è¨ˆ (Core Module Design)](#7-æ ¸å¿ƒæ¨¡çµ„è¨­è¨ˆ-core-module-design)
8. [ä½¿ç”¨è€…ä»‹é¢è¨­è¨ˆ (User Interface Design)](#8-ä½¿ç”¨è€…ä»‹é¢è¨­è¨ˆ-user-interface-design)
9. [å¯¦ä½œç´°ç¯€ (Implementation Details)](#9-å¯¦ä½œç´°ç¯€-implementation-details)
10. [æ¸¬è©¦è¨ˆç•« (Testing Plan)](#10-æ¸¬è©¦è¨ˆç•«-testing-plan)
11. [éƒ¨ç½²ç­–ç•¥ (Deployment Strategy)](#11-éƒ¨ç½²ç­–ç•¥-deployment-strategy)
12. [ç¶­è­·èˆ‡æ¼”é€² (Maintenance and Evolution)](#12-ç¶­è­·èˆ‡æ¼”é€²-maintenance-and-evolution)
13. [é¢¨éšªè©•ä¼° (Risk Assessment)](#13-é¢¨éšªè©•ä¼°-risk-assessment)
14. [é™„éŒ„ (Appendix)](#14-é™„éŒ„-appendix)

---

## 1. å°ˆæ¡ˆæ¦‚è¿° (Project Overview)

### 1.1 å°ˆæ¡ˆèƒŒæ™¯

è‡ºé›»ï¼ˆè‡ºç£é›»åŠ›å…¬å¸ï¼‰æä¾›å¤šç¨®é›»åƒ¹æ–¹æ¡ˆï¼ŒåŒ…æ‹¬å‚³çµ±ç´¯é€²è²»ç‡å’Œæ™‚é–“é›»åƒ¹ï¼ˆTime-of-Use, TOUï¼‰æ–¹æ¡ˆã€‚è¨±å¤šä½¿ç”¨è€…ä¸ç­è§£ä¸åŒæ–¹æ¡ˆä¸‹çš„é›»è²»å·®ç•°ï¼Œå¯èƒ½é¸æ“‡äº†ä¸é©åˆè‡ªå·±ç”¨é›»ç¿’æ…£çš„æ–¹æ¡ˆï¼Œå°è‡´ä¸å¿…è¦çš„é›»è²»æ”¯å‡ºã€‚

æœ¬å°ˆæ¡ˆæ—¨åœ¨é–‹ç™¼ä¸€å€‹**ç´”å‰ç«¯çš„ç¶²é æ‡‰ç”¨ç¨‹å¼**ï¼Œè®“ä½¿ç”¨è€…å¯ä»¥ï¼š
1. æ‹ç…§æˆ–ä¸Šå‚³é›»è²»å–®
2. è‡ªå‹•è­˜åˆ¥é›»è²»å–®ä¸Šçš„é—œéµè³‡è¨Š
3. è¨ˆç®—å„ç¨®é›»åƒ¹æ–¹æ¡ˆä¸‹çš„é›»è²»
4. æ¯”è¼ƒä¸åŒæ–¹æ¡ˆçš„å·®ç•°
5. æä¾›çœéŒ¢å»ºè­°

### 1.2 ç¾ç‹€åˆ†æ

**ç¾æœ‰ç³»çµ± (taipower-tou-web)**
- æ¡ç”¨ FastAPI å¾Œç«¯ + React å‰ç«¯çš„é›™å±¤æ¶æ§‹
- åŠŸèƒ½ï¼šä¸Šå‚³ CSV æª”æ¡ˆ â†’ è¨ˆç®—ä¸åŒè²»ç‡æ–¹æ¡ˆçš„é›»è²»
- é™åˆ¶ï¼š
  - éœ€è¦å¾Œç«¯ä¼ºæœå™¨åŸ·è¡Œ
  - ä½¿ç”¨è€…éœ€æº–å‚™ CSV æ ¼å¼çš„ç”¨é›»è³‡æ–™
  - ç„¡æ³•ç›´æ¥è™•ç†é›»è²»å–®

**ç—›é»**
- ä¸€èˆ¬ä½¿ç”¨è€…æ²’æœ‰ CSV æ ¼å¼çš„ç”¨é›»è³‡æ–™
- é›»è²»å–®æ˜¯æœ€å®¹æ˜“å–å¾—çš„ç”¨é›»è³‡æ–™ä¾†æº
- éœ€è¦éƒ¨ç½²å¾Œç«¯ï¼Œå¢åŠ ç¶­è­·æˆæœ¬

### 1.3 è§£æ±ºæ–¹æ¡ˆæ¦‚è¿°

**æ–°çš„ç³»çµ±è¨­è¨ˆ**
- **ç´”å‰ç«¯æ¶æ§‹**ï¼šä½¿ç”¨ React + TypeScriptï¼Œå¯éƒ¨ç½²è‡³ GitHub Pages
- **OCR æŠ€è¡“**ï¼šä½¿ç”¨ Tesseract.js é€²è¡Œç€è¦½å™¨ç«¯æ–‡å­—è­˜åˆ¥
- **é›»è²»å–®è§£æ**ï¼šå¾è‡ºé›»ç´™æœ¬é›»è²»å–®ç…§ç‰‡ä¸­æå–é—œéµè³‡è¨Š
- **è²»ç‡è¨ˆç®—å¼•æ“**ï¼šç§»æ¤ Python taipower-tou å¥—ä»¶çš„é‚è¼¯åˆ° TypeScript
- **æ–¹æ¡ˆæ¯”è¼ƒ**ï¼šé¡¯ç¤ºå„ç¨®è²»ç‡æ–¹æ¡ˆä¸‹çš„é›»è²»å·®ç•°

**æŠ€è¡“äº®é»**
- å®Œå…¨åœ¨ç€è¦½å™¨ç«¯åŸ·è¡Œï¼Œç„¡éœ€å¾Œç«¯ä¼ºæœå™¨
- ä½¿ç”¨è€…è³‡æ–™ä¸ä¸Šå‚³è‡³ä»»ä½•ä¼ºæœå™¨ï¼Œä¿è­·éš±ç§
- é›¶æˆæœ¬éƒ¨ç½²ï¼ˆGitHub Pagesï¼‰
- æ”¯æ´è¡Œå‹•è£ç½®æ‹ç…§ä¸Šå‚³

---

## 2. ç›®æ¨™èˆ‡ç¯„åœ (Goals and Scope)

### 2.1 å°ˆæ¡ˆç›®æ¨™

| ç›®æ¨™é¡åˆ¥ | å…·é«”ç›®æ¨™ | æˆåŠŸæŒ‡æ¨™ (KPI) |
|----------|----------|----------------|
| **åŠŸèƒ½ç›®æ¨™** | OCR è­˜åˆ¥æº–ç¢ºç‡ â‰¥ 80% | æ¸¬è©¦é›†æ­£ç¢ºè­˜åˆ¥ç‡ |
| **åŠŸèƒ½ç›®æ¨™** | æ”¯æ´ 20 ç¨®è‡ºé›»è²»ç‡æ–¹æ¡ˆè¨ˆç®— | æ–¹æ¡ˆè¦†è“‹ç‡ 100% |
| **åŠŸèƒ½ç›®æ¨™** | é›»è²»è¨ˆç®—èª¤å·® < 1% | èˆ‡è‡ºé›»å®˜æ–¹è¨ˆç®—çµæœæ¯”å° |
| **æŠ€è¡“ç›®æ¨™** | ç´”å‰ç«¯æ¶æ§‹ | ç„¡å¾Œç«¯ä¾è³´ |
| **æŠ€è¡“ç›®æ¨™** | éƒ¨ç½²è‡³ GitHub Pages | å¯å…¬é–‹è¨ªå• |
| **ä½¿ç”¨è€…é«”é©—** | å¾ä¸Šå‚³åˆ°çµæœ < 30 ç§’ | ç«¯åˆ°ç«¯è™•ç†æ™‚é–“ |
| **ä½¿ç”¨è€…é«”é©—** | æ”¯æ´è¡Œå‹•è£ç½® | éŸ¿æ‡‰å¼è¨­è¨ˆ |

### 2.2 åŠŸèƒ½ç¯„åœ

#### åŒ…å«åŠŸèƒ½

| æ¨¡çµ„ | åŠŸèƒ½æè¿° | å„ªå…ˆé †åº |
|------|----------|--------|
| **é›»è²»å–®ä¸Šå‚³** | æ”¯æ´æ‹ç…§ã€é¸æ“‡åœ–ç‰‡ã€æ‹–æ›³ä¸Šå‚³ | P0 |
| **OCR è­˜åˆ¥** | è­˜åˆ¥é›»è²»å–®ä¸Šçš„é—œéµæ¬„ä½ | P0 |
| **æ¬„ä½ç·¨è¼¯** | å…è¨±ä½¿ç”¨è€…æ‰‹å‹•ä¿®æ­£è­˜åˆ¥çµæœ | P0 |
| **è²»ç‡è¨ˆç®—** | è¨ˆç®—æ‰€æœ‰å¯ç”¨è²»ç‡æ–¹æ¡ˆçš„é›»è²» | P0 |
| **çµæœæ¯”è¼ƒ** | é¡¯ç¤ºå„æ–¹æ¡ˆçš„é›»è²»èˆ‡å·®ç•° | P0 |
| **çœéŒ¢å»ºè­°** | æ¨è–¦æœ€çœéŒ¢çš„æ–¹æ¡ˆ | P1 |
| **åœ–è¡¨å±•ç¤º** | ä½¿ç”¨åœ–è¡¨è¦–è¦ºåŒ–æ¯”è¼ƒçµæœ | P1 |
| **æ­·å²è¨˜éŒ„** | æœ¬åœ°å„²å­˜æŸ¥è©¢è¨˜éŒ„ | P2 |
| **åˆ†äº«åŠŸèƒ½** | ç”¢ç”Ÿåˆ†äº«é€£çµæˆ–åœ–ç‰‡ | P2 |

#### ä¸åŒ…å«åŠŸèƒ½

- ä½¿ç”¨è€…å¸³è™Ÿç³»çµ±
- é›»è²»å–®è³‡æ–™é›²ç«¯å„²å­˜
- è‡ªå‹•å¾è‡ºé›»ç³»çµ±æŠ“å–é›»è²»è³‡æ–™
- é›»åŠ›ä½¿ç”¨å³æ™‚ç›£æ§
- é æ¸¬æœªä¾†é›»è²»

### 2.3 éç¯„åœå°ˆæ¡ˆ

- ä¸è™•ç†éè‡ºé›»é›»è²»å–®
- ä¸æ”¯æ´ PDF æ ¼å¼é›»è²»å–®ï¼ˆåƒ…æ”¯æ´åœ–ç‰‡æ ¼å¼ï¼‰
- ä¸æä¾›å°ˆæ¥­è«®è©¢æœå‹™
- ä¸ä¿è­‰ OCR è­˜åˆ¥çµæœ 100% æ­£ç¢º

---

## 3. æŠ€è¡“æ¶æ§‹ (Technical Architecture)

### 3.1 ç³»çµ±æ¶æ§‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           ä½¿ç”¨è€…ç€è¦½å™¨ (Browser)                              â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚   UI Layer   â”‚      â”‚  OCR Module  â”‚      â”‚  Calculation â”‚              â”‚
â”‚  â”‚              â”‚      â”‚              â”‚      â”‚    Engine    â”‚              â”‚
â”‚  â”‚  - React     â”‚â—„â”€â”€â”€â”€â–ºâ”‚  Tesseract.jsâ”‚â—„â”€â”€â”€â”€â–ºâ”‚  TypeScript  â”‚              â”‚
â”‚  â”‚  - TypeScriptâ”‚      â”‚  (Chinese)   â”‚      â”‚  - Rate Data â”‚              â”‚
â”‚  â”‚  - Recharts  â”‚      â”‚              â”‚      â”‚  - Logic     â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚         â–²                                              â”‚                    â”‚
â”‚         â”‚                                              â–¼                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚   State      â”‚                              â”‚   Data       â”‚           â”‚
â”‚  â”‚  Management  â”‚                              â”‚   Storage    â”‚           â”‚
â”‚  â”‚   Zustand    â”‚                              â”‚  plans.json  â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚  LocalStorageâ”‚           â”‚
â”‚                                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                                         â”‚ HTTP/HTTPS
                                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        GitHub Pages (Static Hosting)                         â”‚
â”‚                                                                              â”‚
â”‚  - index.html        - assets/                                               â”‚
â”‚  - *.js bundles      - images/                                               â”‚
â”‚  - *.css             - plans.json                                            â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 æŠ€è¡“å †ç–Š

#### å‰ç«¯æ¡†æ¶

| é¡åˆ¥ | æŠ€è¡“é¸æ“‡ | ç‰ˆæœ¬ | ç”¨é€” |
|------|----------|------|------|
| **æ¡†æ¶** | React | 19.x | UI å…ƒä»¶å»ºæ§‹ |
| **èªè¨€** | TypeScript | 5.x | å‹åˆ¥å®‰å…¨ |
| **å»ºç½®å·¥å…·** | Vite | 5.x | å¿«é€Ÿé–‹ç™¼èˆ‡æ‰“åŒ… |
| **ç‹€æ…‹ç®¡ç†** | Zustand | 4.x | è¼•é‡ç´šç‹€æ…‹ç®¡ç† |

#### UI èˆ‡è¦–è¦ºåŒ–

| é¡åˆ¥ | æŠ€è¡“é¸æ“‡ | ç‰ˆæœ¬ | ç”¨é€” |
|------|----------|------|------|
| **åœ–è¡¨åº«** | Recharts | 2.x | è³‡æ–™è¦–è¦ºåŒ– |
| **æ¨£å¼** | Tailwind CSS | 3.x | éŸ¿æ‡‰å¼è¨­è¨ˆ |
| **åœ–ç¤º** | Lucide React | latest | åœ–ç¤ºå…ƒä»¶ |

#### OCR èˆ‡è³‡æ–™è™•ç†

| é¡åˆ¥ | æŠ€è¡“é¸æ“‡ | ç‰ˆæœ¬ | ç”¨é€” |
|------|----------|------|------|
| **OCR** | Tesseract.js | 5.x | æ–‡å­—è­˜åˆ¥ |
| **åœ–ç‰‡è™•ç†** | Canvas API | native | åœ–ç‰‡é è™•ç† |
| **è³‡æ–™è§£æ** | è‡ªè¡Œå¯¦ä½œ | - | é›»è²»å–®æ¬„ä½æå– |

#### å·¥å…·èˆ‡æ¸¬è©¦

| é¡åˆ¥ | æŠ€è¡“é¸æ“‡ | ç‰ˆæœ¬ | ç”¨é€” |
|------|----------|------|------|
| **æ¸¬è©¦æ¡†æ¶** | Vitest | 1.x | å–®å…ƒæ¸¬è©¦ |
| **E2E æ¸¬è©¦** | Playwright | 1.x | ç«¯åˆ°ç«¯æ¸¬è©¦ |
| **ç¨‹å¼ç¢¼å“è³ª** | ESLint | 9.x | Linting |
| **å‹åˆ¥æª¢æŸ¥** | TypeScript | 5.x | å‹åˆ¥æª¢æŸ¥ |
| **æ ¼å¼åŒ–** | Prettier | 3.x | ç¨‹å¼ç¢¼æ ¼å¼åŒ– |

### 3.3 è³‡æ–™æµç¨‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä½¿ç”¨è€…   â”‚â”€â”€â”€â”€â–ºâ”‚  ä¸Šå‚³é›»è²»å–®   â”‚â”€â”€â”€â”€â–ºâ”‚  åœ–ç‰‡é è™•ç†  â”‚
â”‚           â”‚     â”‚              â”‚     â”‚  (å£“ç¸®/æ—‹è½‰) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
                                              â–¼
                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                        â”‚  Tesseract.jsâ”‚
                                        â”‚  OCR è­˜åˆ¥    â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                               â”‚
                                               â–¼
                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                        â”‚  åŸå§‹æ–‡å­—è¼¸å‡º â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                               â”‚
                                               â–¼
                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                        â”‚  æ¬„ä½æå–å™¨  â”‚
                                        â”‚  (æ­£è¦è¡¨ç¤ºå¼)â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                               â”‚
                                               â–¼
                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                        â”‚  äººå·¥ç¢ºèª/   â”‚â”€â”€â”€â”€â–ºâ”‚  æœ€çµ‚è³‡æ–™  â”‚
                                        â”‚  ä¿®æ­£æ¬„ä½    â”‚     â”‚            â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                                                                   â”‚
                                                                   â–¼
                                                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                            â”‚  è²»ç‡è¨ˆç®—å¼•æ“â”‚
                                                            â”‚  (20ç¨®æ–¹æ¡ˆ)  â”‚
                                                            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                   â”‚
                                                                   â–¼
                                                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                            â”‚  çµæœæ¯”è¼ƒèˆ‡  â”‚
                                                            â”‚  è¦–è¦ºåŒ–å±•ç¤º  â”‚
                                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. åŠŸèƒ½éœ€æ±‚ (Functional Requirements)

### 4.1 æ ¸å¿ƒåŠŸèƒ½

#### FR-1: é›»è²»å–®ä¸Šå‚³

| éœ€æ±‚ ID | æè¿° | é©—æ”¶æ¨™æº– |
|---------|------|----------|
| FR-1.1 | æ”¯æ´é¸æ“‡æœ¬æ©Ÿåœ–ç‰‡ä¸Šå‚³ | å¯é¸æ“‡ JPG/PNG æ ¼å¼åœ–ç‰‡ |
| FR-1.2 | æ”¯æ´è£ç½®æ‹ç…§åŠŸèƒ½ | è¡Œå‹•è£ç½®å¯å‘¼å«ç›¸æ©Ÿ |
| FR-1.3 | æ”¯æ´æ‹–æ›³ä¸Šå‚³ | å¯æ‹–æ›³åœ–ç‰‡è‡³æŒ‡å®šå€åŸŸ |
| FR-1.4 | åœ–ç‰‡é è¦½ | ä¸Šå‚³å¾Œé¡¯ç¤ºåœ–ç‰‡é è¦½ |
| FR-1.5 | åœ–ç‰‡å¤§å°é™åˆ¶ | æœ€å¤§ 10MB |
| FR-1.6 | åœ–ç‰‡æ ¼å¼é©—è­‰ | æ‹’çµ•éåœ–ç‰‡æ ¼å¼æª”æ¡ˆ |

#### FR-2: OCR è­˜åˆ¥

| éœ€æ±‚ ID | æè¿° | é©—æ”¶æ¨™æº– |
|---------|------|----------|
| FR-2.1 | è¼‰å…¥ Tesseract.js å¼•æ“ | è¼‰å…¥ç¹é«”ä¸­æ–‡èªè¨€åŒ… |
| FR-2.2 | åŸ·è¡Œæ–‡å­—è­˜åˆ¥ | è¿”å›è­˜åˆ¥çš„æ–‡å­—å…§å®¹ |
| FR-2.3 | è­˜åˆ¥é€²åº¦é¡¯ç¤º | é¡¯ç¤ºè¼‰å…¥èˆ‡è­˜åˆ¥é€²åº¦ |
| FR-2.4 | è­˜åˆ¥éŒ¯èª¤è™•ç† | è­˜åˆ¥å¤±æ•—æ™‚é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯ |

#### FR-3: é›»è²»å–®æ¬„ä½æå–

| éœ€æ±‚ ID | æè¿° | é©—æ”¶æ¨™æº– |
|---------|------|----------|
| FR-3.1 | æå–ä½¿ç”¨è€…åç¨±ç¨± | æ­£è¦è¡¨ç¤ºå¼åŒ¹é…ä½¿ç”¨è€…åç¨± |
| FR-3.2 | æå–é›»è™Ÿ | æ­£è¦è¡¨ç¤ºå¼åŒ¹é… 8-10 ä½æ•¸å­— |
| FR-3.3 | æå–è¨ˆè²»æœŸé–“ | è­˜åˆ¥èµ·è¿„æ—¥æœŸ |
| FR-3.4 | æå–ç”¨é›»åº¦æ•¸ | è­˜åˆ¥ã€Œæœ¬æœŸåº¦æ•¸ã€æ¬„ä½ |
| FR-3.5 | æå–é›»è²»é‡‘é¡ | è­˜åˆ¥ã€Œé›»è²»å°è¨ˆã€æˆ–ã€Œæ‡‰ç¹³ç¸½é¡ã€ |
| FR-3.6 | æå–ç•¶å‰æ–¹æ¡ˆ | è­˜åˆ¥ã€Œé›»åƒ¹æ–¹æ¡ˆã€æ¬„ä½ |
| FR-3.7 | è­˜åˆ¥å°–å³°/é›¢å³°åº¦æ•¸ | è‹¥æœ‰æ™‚é–“é›»åƒ¹ï¼Œåˆ†åˆ¥æå– |

#### FR-4: è²»ç‡è¨ˆç®—

| éœ€æ±‚ ID | æè¿° | é©—æ”¶æ¨™æº– |
|---------|------|----------|
| FR-4.1 | ç´¯é€²è²»ç‡è¨ˆç®— | å¯¦ä½œ Residential Non-TOU æ–¹æ¡ˆ |
| FR-4.2 | å…©æ®µå¼æ™‚é–“é›»åƒ¹ | å¯¦ä½œ Residential Simple 2-Tier æ–¹æ¡ˆ |
| FR-4.3 | ä¸‰æ®µå¼æ™‚é–“é›»åƒ¹ | å¯¦ä½œ Residential Simple 3-Tier æ–¹æ¡ˆ |
| FR-4.4 | åŸºæœ¬é›»è²»è¨ˆç®— | ä¾æ“šå¥‘ç´„å®¹é‡è¨ˆç®—åŸºæœ¬é›»è²» |
| FR-4.5 | æµå‹•é›»è²»è¨ˆç®— | ä¾æ“šç”¨é›»åº¦æ•¸èˆ‡æ™‚é–“è¨ˆç®— |
| FR-4.6 | å­£ç¯€ä¿‚æ•¸ | å¤å­£/éå¤å­£ä¸åŒè²»ç‡ |
| FR-4.7 | ç”¨é›»å‹åˆ¥åˆ¤æ–· | ä½å£“/é«˜å£“ã€å–®ç›¸/ä¸‰ç›¸ |

#### FR-5: çµæœæ¯”è¼ƒèˆ‡å±•ç¤º

| éœ€æ±‚ ID | æè¿° | é©—æ”¶æ¨™æº– |
|---------|------|----------|
| FR-5.1 | æ–¹æ¡ˆåˆ—è¡¨å±•ç¤º | é¡¯ç¤ºæ‰€æœ‰å¯ç”¨æ–¹æ¡ˆ |
| FR-5.2 | é›»è²»é‡‘é¡æ’åº | ä¾é›»è²»ç”±ä½è‡³é«˜æ’åº |
| FR-5.3 | å·®ç•°é‡‘é¡é¡¯ç¤º | é¡¯ç¤ºèˆ‡ç•¶å‰æ–¹æ¡ˆçš„å·®ç•° |
| FR-5.4 | ç¯€çœç™¾åˆ†æ¯” | é¡¯ç¤ºå¯ç¯€çœçš„ç™¾åˆ†æ¯” |
| FR-5.5 | åœ–è¡¨è¦–è¦ºåŒ– | ä½¿ç”¨é•·æ¢åœ–æ¯”è¼ƒå„æ–¹æ¡ˆ |
| FR-5.6 | è©³ç´°è²»ç‡èªªæ˜ | å±•é–‹æª¢è¦–è²»ç‡ç´°ç¯€ |

### 4.2 ä½¿ç”¨è€…æ•…äº‹

#### US-1: ä¸Šå‚³ä¸¦æª¢è¦–çµæœ

```
ä½œç‚º ä¸€èˆ¬ä½¿ç”¨è€…
æˆ‘æƒ³è¦ æ‹ç…§ä¸Šå‚³æˆ‘çš„é›»è²»å–®
ä»¥ä¾¿ å¿«é€Ÿç­è§£æ˜¯å¦æœ‰æ›´çœéŒ¢çš„é›»åƒ¹æ–¹æ¡ˆ

é©—æ”¶æ¨™æº–ï¼š
- å¯ä»¥ä½¿ç”¨ç›¸æ©Ÿæ‹ç…§
- å¯ä»¥é¸æ“‡ç›¸ç°¿ä¸­çš„ç…§ç‰‡
- ä¸Šå‚³å¾Œè‡ªå‹•é–‹å§‹è­˜åˆ¥
- è­˜åˆ¥å®Œæˆå¾Œé¡¯ç¤ºçµæœ
```

#### US-2: ä¿®æ­£è­˜åˆ¥çµæœ

```
ä½œç‚º ä¸€èˆ¬ä½¿ç”¨è€…
æˆ‘æƒ³è¦ æ‰‹å‹•ä¿®æ­£ OCR è­˜åˆ¥éŒ¯èª¤çš„æ¬„ä½
ä»¥ä¾¿ ç¢ºä¿è¨ˆç®—çµæœæ­£ç¢º

é©—æ”¶æ¨™æº–ï¼š
- è­˜åˆ¥çµæœå¯ç·¨è¼¯
- æ¨™ç¤ºè­˜åˆ¥ä¿¡å¿ƒåº¦ä½çš„æ¬„ä½
- ä¿®æ­£å¾Œå¯é‡æ–°è¨ˆç®—
```

#### US-3: ç­è§£æ–¹æ¡ˆå·®ç•°

```
ä½œç‚º ä¸€èˆ¬ä½¿ç”¨è€…
æˆ‘æƒ³è¦ æª¢è¦–ä¸åŒæ–¹æ¡ˆçš„é›»è²»å·®ç•°
ä»¥ä¾¿ æ±ºå®šæ˜¯å¦è¦æ›´æ›æ–¹æ¡ˆ

é©—æ”¶æ¨™æº–ï¼š
- æ¸…æ¥šé¡¯ç¤ºå„æ–¹æ¡ˆé›»è²»
- æ¨™ç¤ºæœ€çœéŒ¢çš„æ–¹æ¡ˆ
- é¡¯ç¤ºå¯ç¯€çœçš„é‡‘é¡
- æä¾›æ–¹æ¡ˆåˆ‡æ›å»ºè­°
```

#### US-4: æ‰‹å‹•è¼¸å…¥è³‡æ–™

```
ä½œç‚º ä¸€èˆ¬ä½¿ç”¨è€…
æˆ‘æƒ³è¦ æ‰‹å‹•è¼¸å…¥ç”¨é›»è³‡æ–™
ä»¥ä¾¿ åœ¨ OCR å¤±æ•—æ™‚ä»å¯ä½¿ç”¨

é©—æ”¶æ¨™æº–ï¼š
- æä¾›æ‰‹å‹•è¼¸å…¥è¡¨å–®
- å¿…å¡«æ¬„ä½é©—è­‰
- èˆ‡ OCR çµæœç„¡ç¸«åˆ‡æ›
```

### 4.3 åŠŸèƒ½å„ªå…ˆé †åº

#### P0 - å¿…é ˆå¯¦ä½œ (MVP)

1. é›»è²»å–®åœ–ç‰‡ä¸Šå‚³
2. OCR æ–‡å­—è­˜åˆ¥
3. åŸºæœ¬æ¬„ä½æå–ï¼ˆåº¦æ•¸ã€æœŸé–“ï¼‰
4. è‡³å°‘ 5 ç¨®å¸¸ç”¨æ–¹æ¡ˆè¨ˆç®—
5. çµæœåˆ—è¡¨é¡¯ç¤º

#### P1 - é‡è¦åŠŸèƒ½

6. æ¬„ä½æ‰‹å‹•ä¿®æ­£
7. å®Œæ•´ 20 ç¨®æ–¹æ¡ˆè¨ˆç®—
8. åœ–è¡¨è¦–è¦ºåŒ–
9. çœéŒ¢å»ºè­°
10. æ‰‹å‹•è¼¸å…¥æ¨¡å¼

#### P2 - å¢å€¼åŠŸèƒ½

11. æ­·å²è¨˜éŒ„
12. åˆ†äº«åŠŸèƒ½
13. å¤šç¨®é›»è²»å–®æ ¼å¼æ”¯æ´
14. æ·±è‰²æ¨¡å¼

---

## 5. éåŠŸèƒ½éœ€æ±‚ (Non-Functional Requirements)

### 5.1 æ•ˆèƒ½éœ€æ±‚

| æŒ‡æ¨™ | ç›®æ¨™å€¼ | æ¸¬é‡æ–¹æ³• |
|------|--------|----------|
| **é¦–é è¼‰å…¥æ™‚é–“** | < 3 ç§’ | Lighthouse Performance Score |
| **OCR è­˜åˆ¥æ™‚é–“** | < 20 ç§’ | å¾ä¸Šå‚³åˆ°è­˜åˆ¥å®Œæˆ |
| **è¨ˆç®—æ™‚é–“** | < 500ms | æ‰€æœ‰æ–¹æ¡ˆè¨ˆç®—å®Œæˆ |
| **é é¢äº’å‹•å»¶é²** | < 100ms | ä½¿ç”¨è€…æ“ä½œåˆ°å›æ‡‰ |
| **è¨˜æ†¶é«”ä½¿ç”¨** | < 200MB | Tesseract.js è¼‰å…¥å¾Œ |
| **å¥—ä»¶å¤§å°** | < 2MB (gzipped) | æ‰“åŒ…å¾Œçš„ JavaScript |

### 5.2 å®‰å…¨éœ€æ±‚

| éœ€æ±‚ | æè¿° | å¯¦ä½œæ–¹å¼ |
|------|------|----------|
| **è³‡æ–™éš±ç§** | ä½¿ç”¨è€…è³‡æ–™ä¸ä¸Šå‚³åˆ°ä¼ºæœå™¨ | ç´”å‰ç«¯è™•ç† |
| **XSS é˜²è­·** | é˜²æ­¢è·¨ç«™æŒ‡ä»¤ç¢¼æ”»æ“Š | React è‡ªå‹•è½‰ç¾© + CSP |
| **HTTPS** | å¼·åˆ¶ä½¿ç”¨ HTTPS | GitHub Pages è‡ªå‹•å•Ÿç”¨ |
| **è¼¸å…¥é©—è­‰** | é©—è­‰æ‰€æœ‰ä½¿ç”¨è€…è¼¸å…¥ | TypeScript å‹åˆ¥æª¢æŸ¥ |
| **ç¬¬ä¸‰æ–¹å¥—ä»¶** | å®šæœŸæ›´æ–°ç›¸ä¾å¥—ä»¶ | Dependabot è‡ªå‹•æ›´æ–° |

### 5.3 å¯ç”¨æ€§éœ€æ±‚

| éœ€æ±‚ | æè¿° | å¯¦ä½œæ–¹å¼ |
|------|------|----------|
| **éŸ¿æ‡‰å¼è¨­è¨ˆ** | æ”¯æ´æ‰‹æ©Ÿã€å¹³æ¿ã€æ¡Œé¢ | Tailwind CSS éŸ¿æ‡‰å¼é¡ |
| **ç„¡éšœç¤™** | ç¬¦åˆ WCAG 2.1 AA | ARIA å±¬æ€§ã€éµç›¤å°èˆª |
| **å¤šèªè¨€** | æ”¯æ´ç¹é«”ä¸­æ–‡ | i18n æˆ–ç›´æ¥ç¡¬é«”ä¸­æ–‡ |
| **éŒ¯èª¤æç¤º** | æ¸…æ¥šçš„éŒ¯èª¤è¨Šæ¯ | ä½¿ç”¨è€…å‹å–„çš„éŒ¯èª¤è¨Šæ¯ |
| **é›¢ç·šæ”¯æ´** | åŸºæœ¬é›¢ç·šåŠŸèƒ½ | Service Worker (å¯é¸) |

### 5.4 ç›¸å®¹æ€§éœ€æ±‚

| é¡åˆ¥ | éœ€æ±‚ |
|------|------|
| **ç€è¦½å™¨** | Chrome 90+, Safari 14+, Firefox 88+, Edge 90+ |
| **è¡Œå‹•è£ç½®** | iOS 14+, Android 10+ |
| **è¢å¹•å°ºå¯¸** | 320px - 2560px å¯¬åº¦ |
| **JavaScript** | ES2020+ æ”¯æ´ |

---

## 6. è³‡æ–™æ¨¡å‹ (Data Models)

### 6.1 è²»ç‡è³‡æ–™çµæ§‹

```typescript
/**
 * è²»ç‡æ–¹æ¡ˆè³‡æ–™çµæ§‹
 * Source: taipower-tou/src/taipower_tou/data/plans.json
 */

interface Season {
  name: 'summer' | 'non_summer';
  start: string;  // "06-01" (MM-DD format)
  end: string;    // "09-30"
}

interface Period {
  name: 'peak' | 'semi_peak' | 'off_peak' | 'flat';
}

interface DayType {
  name: 'weekday' | 'saturday' | 'sunday_holiday';
}

interface TimeSlot {
  period: Period;
  start: string;  // "HH:MM"
  end: string;    // "HH:MM"
}

interface EnergyChargeRate {
  period: Period;
  rate: number;  // å…ƒ/kWh
}

interface BasicChargeRate {
  voltage_type: 'low_voltage' | 'high_voltage';
  phase: 'single' | 'three';
  capacity_range: {
    min: number;
    max: number | null;
  };
  summer_rate: number;
  non_summer_rate: number;
}

interface TierRate {
  tier: number;
  min_kwh: number;
  max_kwh: number | null;
  rate: number;  // å…ƒ/kWh
}

interface Plan {
  id: string;                    // e.g., "residential_non_tou"
  name: string;                  // e.g., "ä½å®¶ç”¨é›»ï¼ˆéæ™‚é–“é›»åƒ¹ï¼‰"
  name_en: string;               // e.g., "Residential (Non-TOU)"
  type: 'residential' | 'lighting' | 'commercial';
  tou_type: 'none' | 'simple_2_tier' | 'simple_3_tier' | 'full_tou';
  voltage: 'low_voltage' | 'high_voltage';
  requires_meter: boolean;       // æ˜¯å¦éœ€è¦ç‰¹æ®Šé›»éŒ¶
  minimum_consumption: number | null;

  // è²»ç‡è³‡æ–™
  basic_charges: BasicChargeRate[];
  energy_charges: {
    summer: EnergyChargeRate[];
    non_summer: EnergyChargeRate[];
  };

  // æ™‚é–“é›»åƒ¹å°ˆç”¨
  time_slots?: {
    weekday: TimeSlot[];
    saturday: TimeSlot[];
    sunday_holiday: TimeSlot[];
  };

  // ç´¯é€²è²»ç‡å°ˆç”¨
  tier_rates?: TierRate[];

  // å­£ç¯€å®šç¾©
  seasons: {
    summer: Season;
    non_summer: Season;
  };
}

interface PlansData {
  version: string;               // e.g., "20251001"
  definitions: {
    seasons: Season[];
    seasons_high_voltage: Season[];
    periods: Period[];
    day_types: DayType[];
  };
  plans: Plan[];
}
```

### 6.2 é›»è²»å–®è³‡æ–™çµæ§‹

```typescript
/**
 * é›»è²»å–®æ¬„ä½è³‡æ–™çµæ§‹
 * å¾ OCR è­˜åˆ¥çµæœä¸­æå–
 */

interface ElectricityBill {
  // åŸºæœ¬è³‡è¨Š
  customerName?: string;         // ä½¿ç”¨è€…åç¨±ç¨±
  accountNumber?: string;        // é›»è™Ÿ (8-10 ä½æ•¸å­—)

  // è¨ˆè²»æœŸé–“
  billingPeriod: {
    startDate: Date;             // è¨ˆè²»èµ·å§‹æ—¥
    endDate: Date;               // è¨ˆè²»çµ‚æ­¢æ—¥
    days: number;                // è¨ˆè²»å¤©æ•¸
  };

  // ç”¨é›»è³‡è¨Š
  consumption: {
    previousReading: number;     // ä¸ŠæœŸåº¦æ•¸
    currentReading: number;      // æœ¬æœŸåº¦æ•¸
    usage: number;               // ç”¨é›»åº¦æ•¸ (kWh)
    multiplier: number;          // å€æ•¸ (é€šå¸¸ç‚º 1)
  };

  // ç•¶å‰æ–¹æ¡ˆèˆ‡é›»è²»
  currentPlan?: {
    name: string;                // ç•¶å‰æ–¹æ¡ˆåç¨±
    baseCharge: number;          // åŸºæœ¬é›»è²»
    energyCharge: number;        // æµå‹•é›»è²»
    total: number;               // æ‡‰ï¿½ç¸½é¡
  };

  // æ™‚é–“é›»åƒ¹ç”¨é›»æ˜ç´° (è‹¥æœ‰)
  touConsumption?: {
    peakOnPeak: number;          // å°–å³°ç”¨é›»
    semiPeak: number;            // åŠå°–å³°ç”¨é›»
    offPeak: number;             // é›¢å³°ç”¨é›»
    total: number;               // ç¸½ç”¨é›»
  };

  // OCR è­˜åˆ¥è³‡è¨Š
  ocrMetadata: {
    confidence: number;          // æ•´é«”ä¿¡å¿ƒåº¦ (0-1)
    fieldConfidences: {          // å„æ¬„ä½ä¿¡å¿ƒåº¦
      [key: string]: number;
    };
    processingTime: number;      // è™•ç†æ™‚é–“ (ms)
  };
}

/**
 * æ‰‹å‹•è¼¸å…¥çš„ç°¡åŒ–ç‰ˆè³‡æ–™çµæ§‹
 */
interface ManualConsumptionInput {
  billingPeriod: {
    month: number;               // æœˆä»½ (1-12)
    year: number;                // å¹´ä»½
  };
  consumption: {
    peakOnPeak?: number;         // å°–å³°ç”¨é›» (å¯é¸)
    semiPeak?: number;           // åŠå°–å³°ç”¨é›» (å¯é¸)
    offPeak?: number;            // é›¢å³°ç”¨é›» (å¯é¸)
    total: number;               // ç¸½ç”¨é›» (å¿…å¡«)
  };
  voltageType: 'low_voltage' | 'high_voltage';
  phase: 'single' | 'three';
  contractCapacity?: number;     // å¥‘ç´„å®¹é‡ (kW)
}
```

### 6.3 è¨ˆç®—çµæœè³‡æ–™çµæ§‹

```typescript
/**
 * è²»ç‡è¨ˆç®—çµæœ
 */
interface PlanCalculationResult {
  planId: string;
  planName: string;
  planNameEn: string;

  // è¨ˆç®—çµæœ
  charges: {
    base: number;                // åŸºæœ¬é›»è²»
    energy: number;              // æµå‹•é›»è²»
    total: number;               // ç¸½é›»è²»
  };

  // è©³ç´°æ˜ç´°
  breakdown: {
    tierBreakdown?: {            // ç´¯é€²è²»ç‡æ˜ç´°
      tier: number;
      kwh: number;
      rate: number;
      charge: number;
    }[];
    touBreakdown?: {             // æ™‚é–“é›»åƒ¹æ˜ç´°
      period: 'peak' | 'semi_peak' | 'off_peak';
      kwh: number;
      rate: number;
      charge: number;
    }[];
  };

  // èˆ‡ç•¶å‰æ–¹æ¡ˆæ¯”è¼ƒ
  comparison: {
    isCurrentPlan: boolean;      // æ˜¯å¦ç‚ºç•¶å‰æ–¹æ¡ˆ
    difference: number;          // èˆ‡ç•¶å‰æ–¹æ¡ˆå·®ç•°
    savingPercentage: number;    // ç¯€çœç™¾åˆ†æ¯” (è² å€¼è¡¨ç¤ºæ›´è²´)
  };

  // å­£ç¯€è³‡è¨Š
  seasonInfo: {
    season: 'summer' | 'non_summer';
    isSummer: boolean;
  };
}

/**
 * å®Œæ•´çš„è¨ˆç®—å›æ‡‰
 */
interface CalculationResponse {
  input: {
    consumption: number;
    billingPeriod: {
      start: Date;
      end: Date;
    };
  };
  results: PlanCalculationResult[];
  recommendations: {
    cheapestPlan: {
      planId: string;
      planName: string;
      totalCost: number;
    };
    maximumSaving: {
      planId: string;
      planName: string;
      amount: number;
      percentage: number;
    };
    switchablePlans: string[];   // å¯åˆ‡æ›çš„æ–¹æ¡ˆ
  };
}
```

---

## 7. æ ¸å¿ƒæ¨¡çµ„è¨­è¨ˆ (Core Module Design)

### 7.1 OCR æ¨¡çµ„

#### æ¨¡çµ„æ¶æ§‹

```typescript
/**
 * OCR æ¨¡çµ„ - è² è²¬åœ–ç‰‡æ–‡å­—è­˜åˆ¥
 *
 * è·è²¬ï¼š
 * 1. è¼‰å…¥ä¸¦åˆå§‹åŒ– Tesseract.js
 * 2. é è™•ç†åœ–ç‰‡ (å£“ç¸®ã€æ—‹è½‰ã€ç°éš)
 * 3. åŸ·è¡Œ OCR è­˜åˆ¥
 * 4. å›å‚³è­˜åˆ¥çµæœèˆ‡ä¿¡å¿ƒåº¦
 */

// services/ocr/OCRService.ts
interface OCRServiceConfig {
  language: 'chi_tra' | 'chi_sim' | 'eng';
  logger?: Logger;
}

interface OCRResult {
  text: string;                  // è­˜åˆ¥çš„æ–‡å­—
  confidence: number;            // æ•´é«”ä¿¡å¿ƒåº¦ (0-1)
  words: {                      // å–®è©å±¤ç´šçµæœ
    text: string;
    confidence: number;
    bbox: {
      x0: number;
      y0: number;
      x1: number;
      y1: number;
    };
  }[];
  processingTime: number;        // è™•ç†æ™‚é–“ (ms)
}

class OCRService {
  private worker: Tesseract.Worker | null = null;
  private config: OCRServiceConfig;

  constructor(config: OCRServiceConfig) {
    this.config = config;
  }

  /**
   * åˆå§‹åŒ– Tesseract.js worker
   */
  async initialize(): Promise<void> {
    // å¯¦ä½œç´°ç¯€...
  }

  /**
   * é è™•ç†åœ–ç‰‡
   * - å£“ç¸®åœ–ç‰‡ä»¥æ¸›å°‘è™•ç†æ™‚é–“
   * - è‡ªå‹•æ—‹è½‰
   * - è½‰æ›ç‚ºç°éš
   */
  private async preprocessImage(file: File): Promise<string> {
    // ä½¿ç”¨ Canvas API è™•ç†åœ–ç‰‡
    // å¯¦ä½œç´°ç¯€...
  }

  /**
   * åŸ·è¡Œ OCR è­˜åˆ¥
   * @param imageFile - åœ–ç‰‡æª”æ¡ˆ
   * @param onProgress - é€²åº¦å›å‘¼å‡½å¼
   */
  async recognize(
    imageFile: File,
    onProgress?: (progress: number) => void
  ): Promise<OCRResult> {
    // å¯¦ä½œç´°ç¯€...
  }

  /**
   * æ¸…ç†è³‡æº
   */
  async terminate(): Promise<void> {
    // å¯¦ä½œç´°ç¯€...
  }
}
```

#### åœ–ç‰‡é è™•ç†

```typescript
/**
 * åœ–ç‰‡é è™•ç†å·¥å…·
 */
class ImagePreprocessor {
  /**
   * å£“ç¸®åœ–ç‰‡
   * @param maxSize - æœ€å¤§é‚Šé•· (px)
   * @param quality - JPEG å“è³ª (0-1)
   */
  static async compress(
    file: File,
    maxSize: number = 2000,
    quality: number = 0.9
  ): Promise<string> {
    // Canvas å¯¦ä½œ...
  }

  /**
   * è½‰æ›ç‚ºç°éš
   */
  static async toGrayscale(imageDataUrl: string): Promise<string> {
    // å¯¦ä½œç´°ç¯€...
  }

  /**
   * äºŒå€¼åŒ–è™•ç† (æé«˜ OCR æº–ç¢ºåº¦)
   */
  static async binarize(imageDataUrl: string): Promise<string> {
    // å¯¦ä½œç´°ç¯€...
  }
}
```

### 7.2 é›»è²»å–®è§£æå™¨

```typescript
/**
 * é›»è²»å–®è§£æå™¨ - å¾ OCR æ–‡å­—ä¸­æå–æ¬„ä½
 *
 * è·è²¬ï¼š
 * 1. è§£æ OCR è¼¸å‡ºçš„æ–‡å­—
 * 2. ä½¿ç”¨æ­£è¦è¡¨ç¤ºå¼æå–æ¬„ä½
 * 3. é©—è­‰æå–çµæœçš„åˆç†æ€§
 * 4. æ¨™ç¤ºä½ä¿¡å¿ƒåº¦çš„æ¬„ä½
 */

// services/parser/BillParser.ts

interface ParsedBill {
  customerName?: string;
  accountNumber?: string;
  billingPeriod: {
    startDate: Date;
    endDate: Date;
  };
  consumption: {
    previousReading: number;
    currentReading: number;
    usage: number;
  };
  currentPlan?: {
    name: string;
    total: number;
  };
  confidences: {
    [field: string]: number;
  };
}

class BillParser {
  /**
   * æ­£è¦è¡¨ç¤ºå¼æ¨¡å¼
   */
  private static PATTERNS = {
    // é›»è™Ÿ: 8-10 ä½æ•¸å­—
    accountNumber: /é›»è™Ÿ[:\s]*([0-9]{8,10})/,

    // æ—¥æœŸ: ä¸­è¯æ°‘åœ‹ XXX å¹´ XX æœˆ XX æ—¥
    date: /ä¸­è¯æ°‘åœ‹(\d{2,3})å¹´(\d{1,2})æœˆ(\d{1,2})æ—¥/,

    // ç”¨é›»åº¦æ•¸
    consumption: /æœ¬æœŸåº¦æ•¸[:\s]*([\d,]+)/,

    // é›»è²»é‡‘é¡
    amount: /(?:æ‡‰ç¹³ç¸½é¡|é›»è²»å°è¨ˆ)[:\s]*\$?([\d,]+)/,

    // æ–¹æ¡ˆåç¨±
    planName: /é›»åƒ¹æ–¹æ¡ˆ[:\s]*([^\s\n]+)/,
  };

  /**
   * è§£æé›»è²»å–®
   * @param ocrResult - OCR è­˜åˆ¥çµæœ
   */
  static parse(ocrResult: OCRResult): ParsedBill {
    const text = ocrResult.text;
    const parsed: ParsedBill = {
      billingPeriod: { startDate: new Date(), endDate: new Date() },
      consumption: { previousReading: 0, currentReading: 0, usage: 0 },
      confidences: {},
    };

    // æå–å„æ¬„ä½...
    return parsed;
  }

  /**
   * é©—è­‰è§£æçµæœ
   */
  static validate(parsed: ParsedBill): {
    isValid: boolean;
    errors: string[];
  } {
    // é©—è­‰é‚è¼¯...
  }

  /**
   * è½‰æ›ç‚ºè¨ˆç®—å¼•æ“è¼¸å…¥æ ¼å¼
   */
  static toCalculationInput(parsed: ParsedBill): CalculationInput {
    // è½‰æ›é‚è¼¯...
  }
}
```

### 7.3 è²»ç‡è¨ˆç®—å¼•æ“

```typescript
/**
 * è²»ç‡è¨ˆç®—å¼•æ“ - ç§»æ¤è‡ª Python taipower-tou
 *
 * è·è²¬ï¼š
 * 1. è¼‰å…¥è²»ç‡è³‡æ–™ (plans.json)
 * 2. å¯¦ä½œå„ç¨®è²»ç‡æ–¹æ¡ˆçš„è¨ˆç®—é‚è¼¯
 * 3. è™•ç†å­£ç¯€ã€æ™‚æ®µã€ç´¯é€²ç­‰è¤‡é›œè¦å‰‡
 * 4. å›å‚³è¨ˆç®—çµæœ
 */

// services/calculation/RateCalculator.ts

interface CalculationInput {
  consumption: number;           // ç¸½ç”¨é›»åº¦æ•¸
  billingPeriod: {
    start: Date;
    end: Date;
  };
  // æ™‚é–“é›»åƒ¹ç”¨
  touConsumption?: {
    peakOnPeak: number;
    semiPeak: number;
    offPeak: number;
  };
  // å¥‘ç´„è³‡è¨Š
  voltageType: 'low_voltage' | 'high_voltage';
  phase: 'single' | 'three';
  contractCapacity?: number;
}

class RateCalculator {
  private plans: Plan[];
  private seasons: Season[];

  constructor(plansData: PlansData) {
    this.plans = plansData.plans;
    this.seasons = plansData.definitions.seasons;
  }

  /**
   * è¨ˆç®—æ‰€æœ‰å¯ç”¨æ–¹æ¡ˆçš„é›»è²»
   */
  calculateAll(input: CalculationInput): PlanCalculationResult[] {
    const season = this.determineSeason(input.billingPeriod);
    const availablePlans = this.getAvailablePlans(input);

    return availablePlans.map(plan => {
      return this.calculatePlan(plan, input, season);
    }).sort((a, b) => a.charges.total - b.charges.total);
  }

  /**
   * è¨ˆç®—å–®ä¸€æ–¹æ¡ˆ
   */
  private calculatePlan(
    plan: Plan,
    input: CalculationInput,
    season: Season
  ): PlanCalculationResult {
    switch (plan.tou_type) {
      case 'none':
        return this.calculateNonTOU(plan, input, season);
      case 'simple_2_tier':
        return this.calculateSimple2Tier(plan, input, season);
      case 'simple_3_tier':
        return this.calculateSimple3Tier(plan, input, season);
      case 'full_tou':
        return this.calculateFullTOU(plan, input, season);
      default:
        throw new Error(`Unknown TOU type: ${plan.tou_type}`);
    }
  }

  /**
   * éæ™‚é–“é›»åƒ¹ (ç´¯é€²è²»ç‡) è¨ˆç®—
   */
  private calculateNonTOU(
    plan: Plan,
    input: CalculationInput,
    season: Season
  ): PlanCalculationResult {
    const tierRates = plan.tier_rates!;
    let totalEnergyCharge = 0;
    let remainingKwh = input.consumption;
    const breakdown: any[] = [];

    for (const tier of tierRates) {
      if (remainingKwh <= 0) break;

      const tierKwh = Math.min(
        remainingKwh,
        (tier.max_kwh ?? Infinity) - tier.min_kwh
      );
      const charge = tierKwh * tier.rate;

      totalEnergyCharge += charge;
      remainingKwh -= tierKwh;

      breakdown.push({
        tier: tier.tier,
        kwh: tierKwh,
        rate: tier.rate,
        charge: charge,
      });
    }

    return {
      planId: plan.id,
      planName: plan.name,
      planNameEn: plan.name_en,
      charges: {
        base: 0,  // å¾…å¯¦ä½œ
        energy: totalEnergyCharge,
        total: totalEnergyCharge,
      },
      breakdown: { tierBreakdown: breakdown },
      comparison: { isCurrentPlan: false, difference: 0, savingPercentage: 0 },
      seasonInfo: { season: season.name, isSummer: season.name === 'summer' },
    };
  }

  /**
   * å…©æ®µå¼æ™‚é–“é›»åƒ¹è¨ˆç®—
   */
  private calculateSimple2Tier(
    plan: Plan,
    input: CalculationInput,
    season: Season
  ): PlanCalculationResult {
    // å¯¦ä½œç´°ç¯€...
  }

  /**
   * ä¸‰æ®µå¼æ™‚é–“é›»åƒ¹è¨ˆç®—
   */
  private calculateSimple3Tier(
    plan: Plan,
    input: CalculationInput,
    season: Season
  ): PlanCalculationResult {
    // å¯¦ä½œç´°ç¯€...
  }

  /**
   * å®Œæ•´æ™‚é–“é›»åƒ¹è¨ˆç®—
   */
  private calculateFullTOU(
    plan: Plan,
    input: CalculationInput,
    season: Season
  ): PlanCalculationResult {
    // å¯¦ä½œç´°ç¯€...
  }

  /**
   * åˆ¤æ–·è¨ˆè²»æœˆä»½å±¬æ–¼å“ªå€‹å­£ç¯€
   */
  private determineSeason(period: { start: Date; end: Date }): Season {
    const month = period.start.getMonth() + 1;
    const isSummer = month >= 6 && month <= 9;
    return {
      name: isSummer ? 'summer' : 'non_summer',
      start: isSummer ? '06-01' : '10-01',
      end: isSummer ? '09-30' : '05-31',
    };
  }

  /**
   * å–å¾—é©ç”¨çš„è²»ç‡æ–¹æ¡ˆ
   */
  private getAvailablePlans(input: CalculationInput): Plan[] {
    // æ ¹æ“šé›»å£“å‹åˆ¥ã€å¥‘ç´„å®¹é‡ç­‰ç¯©é¸
    return this.plans.filter(plan => {
      // å¯¦ä½œç¯©é¸é‚è¼¯...
      return true;
    });
  }
}
```

### 7.4 æ–¹æ¡ˆæ¯”è¼ƒæ¨¡çµ„

```typescript
/**
 * æ–¹æ¡ˆæ¯”è¼ƒæ¨¡çµ„
 *
 * è·è²¬ï¼š
 * 1. æ’åºè¨ˆç®—çµæœ
 * 2. è¨ˆç®—æ–¹æ¡ˆé–“å·®ç•°
 * 3. ç”¢ç”Ÿå»ºè­°
 */

// services/comparison/ComparisonService.ts

interface ComparisonOptions {
  currentPlanId?: string;
  currentPlanCost?: number;
}

class ComparisonService {
  /**
   * æ¯”è¼ƒæ–¹æ¡ˆ
   */
  static compare(
    results: PlanCalculationResult[],
    options: ComparisonOptions
  ): ComparisonResult {
    const sorted = [...results].sort((a, b) =>
      a.charges.total - b.charges.total
    );

    const cheapest = sorted[0];
    const current = options.currentPlanId
      ? sorted.find(r => r.planId === options.currentPlanId)
      : undefined;

    return {
      cheapest: cheapest,
      current: current,
      maximumSaving: current
        ? {
            planId: cheapest.planId,
            planName: cheapest.planName,
            amount: current.charges.total - cheapest.charges.total,
            percentage:
              ((current.charges.total - cheapest.charges.total) /
                current.charges.total) * 100,
          }
        : undefined,
      rankings: sorted.map((r, index) => ({
        ...r,
        rank: index + 1,
        difference: current ? r.charges.total - current.charges.total : 0,
      })),
    };
  }

  /**
   * ç”¢ç”Ÿå»ºè­°
   */
  static generateRecommendations(
    comparison: ComparisonResult
  ): Recommendation[] {
    const recommendations: Recommendation[] = [];

    // æœ€çœéŒ¢æ–¹æ¡ˆå»ºè­°
    if (comparison.maximumSaving) {
      recommendations.push({
        type: 'saving',
        title: 'åˆ‡æ›è‡³æœ€çœéŒ¢æ–¹æ¡ˆ',
        description: `æ”¹ç”¨ ${comparison.maximumSaving.planName} æ¯æœˆå¯çœ $${comparison.maximumSaving.amount}`,
        action: 'switch',
        targetPlan: comparison.maximumSaving.planId,
      });
    }

    return recommendations;
  }
}
```

---

## 8. ä½¿ç”¨è€…ä»‹é¢è¨­è¨ˆ (User Interface Design)

### 8.1 é é¢çµæ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           Header                                    â”‚
â”‚  Logo  |  è‡ºé›»æ™‚é–“é›»åƒ¹æ¯”è¼ƒ  |  èªªæ˜                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚                      ä¸»è¦å…§å®¹å€                                â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  Step 1: ä¸Šå‚³é›»è²»å–®                                      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                         â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  [æ‹–æ›³å€åŸŸ] æˆ– [é¸æ“‡æª”æ¡ˆ] æˆ– [æ‹ç…§]                      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                         â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  åœ–ç‰‡é è¦½                                               â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  Step 2: ç¢ºèªè³‡æ–™ (OCR è­˜åˆ¥çµæœ)                        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                         â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  è¨ˆè²»æœŸé–“: [2025-01-01 ~ 2025-01-31]                    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  ç”¨é›»åº¦æ•¸: [350] kWh                                    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  ç•¶å‰æ–¹æ¡ˆ: [ä½å®¶ç”¨é›»ï¼ˆéæ™‚é–“é›»åƒ¹ï¼‰]                      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  ç•¶å‰é›»è²»: [$2,345]                                     â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                         â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  [é‡æ–°è­˜åˆ¥] [æ‰‹å‹•è¼¸å…¥] [ç¢ºèªç„¡èª¤ï¼Œé–‹å§‹è¨ˆç®—]              â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  Step 3: æ–¹æ¡ˆæ¯”è¼ƒçµæœ                                    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                         â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  [åœ–è¡¨] å„æ–¹æ¡ˆé›»è²»æ¯”è¼ƒ (é•·æ¢åœ–)                    â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                         â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  æ–¹æ¡ˆæ’å                                               â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  ğŸ¥‡ ä¸‰æ®µå¼æ™‚é–“é›»åƒ¹      $2,100  çœ $245 (10.4%)    â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  ğŸ¥ˆ å…©æ®µå¼æ™‚é–“é›»åƒ¹      $2,180  çœ $165 (7.0%)     â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  3  ä½å®¶ç”¨é›»(éæ™‚é–“)    $2,345  ç•¶å‰æ–¹æ¡ˆ            â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  4  ç…§æ˜ç”¨é›»(éæ™‚é–“)    $2,500  å¤š $155             â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                         â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  [æª¢è¦–è©³ç´°] [åˆ†äº«çµæœ]                                 â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                           Footer                                    â”‚
â”‚  èªªæ˜ | éš±ç§æ”¿ç­– | é—œæ–¼æœ¬ç«™                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 äº’å‹•æµç¨‹

#### ä¸»è¦æµç¨‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é€²å…¥ç¶²ç«™â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: ä¸Šå‚³ â”‚â—„â”€â”€â”€â”€â”€â”
â”‚ é›»è²»å–®ç…§ç‰‡    â”‚      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
       â”‚              â”‚
       â–¼              â”‚ (å¯è¿”å›)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ OCR è­˜åˆ¥ä¸­...     â”‚  â”‚
â”‚ é¡¯ç¤ºé€²åº¦æ¢        â”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
       â”‚              â”‚
       â–¼              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ Step 2: ç¢ºèªè³‡æ–™  â”‚  â”‚
â”‚ - é¡¯ç¤ºè­˜åˆ¥çµæœ    â”‚  â”‚
â”‚ - æ¨™ç¤ºä½ä¿¡å¿ƒæ¬„ä½  â”‚  â”‚
â”‚ - å…è¨±æ‰‹å‹•ä¿®æ­£    â”‚  â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â”‚
      â”‚     â”‚         â”‚
      â–¼     â–¼         â”‚
   [ä¿®æ­£] [é‡æ–°è­˜åˆ¥]  â”‚
      â”‚     â”‚         â”‚
      â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: è¨ˆç®—ä¸­   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: æª¢è¦–çµæœ â”‚â—„â”€â”€â”€â”€â”€â”
â”‚ - æ–¹æ¡ˆæ’å        â”‚      â”‚
â”‚ - åœ–è¡¨å±•ç¤º        â”‚      â”‚
â”‚ - çœéŒ¢å»ºè­°        â”‚      â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜      â”‚
      â”‚     â”‚             â”‚
      â–¼     â–¼             â”‚
  [åˆ†äº«] [é‡æ–°é–‹å§‹] â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ‰‹å‹•è¼¸å…¥æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ‰‹å‹•è¼¸å…¥æ¨¡å¼      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: è¼¸å…¥åŸºæœ¬  â”‚
â”‚ è³‡è¨Š              â”‚
â”‚ - è¨ˆè²»æœˆä»½        â”‚
â”‚ - ç”¨é›»åº¦æ•¸        â”‚
â”‚ - é›»å£“å‹åˆ¥        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: é€²éšé¸é … â”‚
â”‚ (å¯é¸)            â”‚
â”‚ - å°–å³°ç”¨é›»        â”‚
â”‚ - é›¢å³°ç”¨é›»        â”‚
â”‚ - å¥‘ç´„å®¹é‡        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æª¢è¦–çµæœ          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.3 éŸ¿æ‡‰å¼è¨­è¨ˆ

#### æ–·é»å®šç¾©

| æ–·é»åç¨± | å¯¬åº¦ç¯„åœ | ç›®æ¨™è£ç½® |
|----------|----------|----------|
| `sm` | 640px+ | æ‰‹æ©Ÿ (æ©«å‘) |
| `md` | 768px+ | å¹³æ¿ |
| `lg` | 1024px+ | æ¡Œé¢ |
| `xl` | 1280px+ | å¤§è¢å¹• |

#### æ‰‹æ©Ÿç‰ˆèª¿æ•´

- å–®æ¬„å¼ä½ˆå±€
- åœ–è¡¨å¯æ©«å‘æ»‘å‹•
- å¡ç‰‡å¼æ–¹æ¡ˆåˆ—è¡¨
- ç°¡åŒ–é¡¯ç¤ºè³‡è¨Š

#### å¹³æ¿ç‰ˆèª¿æ•´

- å…©æ¬„å¼ä½ˆå±€
- åœ–è¡¨èˆ‡åˆ—è¡¨ä¸¦æ’

#### æ¡Œé¢ç‰ˆèª¿æ•´

- ä¸‰æ¬„å¼ä½ˆå±€
- å´é‚Šæ¬„é¡¯ç¤ºèªªæ˜
- å®Œæ•´è³‡è¨Šå±•ç¤º

---

## 9. å¯¦ä½œç´°ç¯€ (Implementation Details)

### 9.1 å°ˆæ¡ˆçµæ§‹

```
taipower-tou-web/
â”œâ”€â”€ public/                      # éœæ…‹è³‡æº
â”‚   â”œâ”€â”€ fonts/                  # å­—å‹æª”æ¡ˆ
â”‚   â”œâ”€â”€ images/                 # åœ–ç¤ºèˆ‡åœ–ç‰‡
â”‚   â””â”€â”€ plans.json              # è²»ç‡è³‡æ–™
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/             # React å…ƒä»¶
â”‚   â”‚   â”œâ”€â”€ layout/             # ä½ˆå±€å…ƒä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ Header.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Footer.tsx
â”‚   â”‚   â”‚   â””â”€â”€ Container.tsx
â”‚   â”‚   â”œâ”€â”€ upload/             # ä¸Šå‚³ç›¸é—œ
â”‚   â”‚   â”‚   â”œâ”€â”€ UploadZone.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ImagePreview.tsx
â”‚   â”‚   â”‚   â””â”€â”€ CameraButton.tsx
â”‚   â”‚   â”œâ”€â”€ ocr/                # OCR ç›¸é—œ
â”‚   â”‚   â”‚   â”œâ”€â”€ OCRProgress.tsx
â”‚   â”‚   â”‚   â””â”€â”€ OCRResult.tsx
â”‚   â”‚   â”œâ”€â”€ form/               # è¡¨å–®å…ƒä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ BillForm.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ FieldEditor.tsx
â”‚   â”‚   â”‚   â””â”€â”€ ManualInput.tsx
â”‚   â”‚   â”œâ”€â”€ results/            # çµæœå±•ç¤º
â”‚   â”‚   â”‚   â”œâ”€â”€ ResultChart.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ PlanList.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ PlanCard.tsx
â”‚   â”‚   â”‚   â””â”€â”€ Recommendation.tsx
â”‚   â”‚   â””â”€â”€ common/             # é€šç”¨å…ƒä»¶
â”‚   â”‚       â”œâ”€â”€ Button.tsx
â”‚   â”‚       â”œâ”€â”€ Card.tsx
â”‚   â”‚       â”œâ”€â”€ Input.tsx
â”‚   â”‚       â””â”€â”€ Loading.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ services/               # æœå‹™å±¤
â”‚   â”‚   â”œâ”€â”€ ocr/
â”‚   â”‚   â”‚   â”œâ”€â”€ OCRService.ts   # OCR ä¸»æœå‹™
â”‚   â”‚   â”‚   â””â”€â”€ ImagePreprocessor.ts
â”‚   â”‚   â”œâ”€â”€ parser/
â”‚   â”‚   â”‚   â”œâ”€â”€ BillParser.ts   # é›»è²»å–®è§£æå™¨
â”‚   â”‚   â”‚   â””â”€â”€ patterns.ts     # æ­£è¦è¡¨ç¤ºå¼æ¨¡å¼
â”‚   â”‚   â”œâ”€â”€ calculation/
â”‚   â”‚   â”‚   â”œâ”€â”€ RateCalculator.ts  # è²»ç‡è¨ˆç®—å¼•æ“
â”‚   â”‚   â”‚   â”œâ”€â”€ plans.ts            # è²»ç‡è³‡æ–™è¼‰å…¥
â”‚   â”‚   â”‚   â””â”€â”€ types.ts            # å‹åˆ¥å®šç¾©
â”‚   â”‚   â””â”€â”€ comparison/
â”‚   â”‚       â””â”€â”€ ComparisonService.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ stores/                 # ç‹€æ…‹ç®¡ç† (Zustand)
â”‚   â”‚   â”œâ”€â”€ useAppStore.ts      # ä¸» store
â”‚   â”‚   â”œâ”€â”€ useOCRStore.ts      # OCR ç‹€æ…‹
â”‚   â”‚   â””â”€â”€ useResultStore.ts   # çµæœç‹€æ…‹
â”‚   â”‚
â”‚   â”œâ”€â”€ hooks/                  # è‡ªè¨‚ Hooks
â”‚   â”‚   â”œâ”€â”€ useOCR.ts           # OCR æ•´åˆ
â”‚   â”‚   â”œâ”€â”€ useCalculation.ts   # è¨ˆç®—æ•´åˆ
â”‚   â”‚   â””â”€â”€ useMediaQuery.ts    # éŸ¿æ‡‰å¼
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/                  # å·¥å…·å‡½å¼
â”‚   â”‚   â”œâ”€â”€ date.ts             # æ—¥æœŸè™•ç†
â”‚   â”‚   â”œâ”€â”€ format.ts           # æ ¼å¼åŒ–
â”‚   â”‚   â””â”€â”€ validation.ts       # é©—è­‰
â”‚   â”‚
â”‚   â”œâ”€â”€ types/                  # å‹åˆ¥å®šç¾©
â”‚   â”‚   â”œâ”€â”€ index.d.ts
â”‚   â”‚   â”œâ”€â”€ ocr.d.ts
â”‚   â”‚   â”œâ”€â”€ bill.d.ts
â”‚   â”‚   â””â”€â”€ calculation.d.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ styles/                 # æ¨£å¼
â”‚   â”‚   â”œâ”€â”€ globals.css
â”‚   â”‚   â””â”€â”€ tailwind.css
â”‚   â”‚
â”‚   â”œâ”€â”€ App.tsx                 # ä¸»æ‡‰ç”¨
â”‚   â”œâ”€â”€ main.tsx                # é€²å…¥é»
â”‚   â””â”€â”€ vite-env.d.ts
â”‚
â”œâ”€â”€ tests/                      # æ¸¬è©¦
â”‚   â”œâ”€â”€ unit/                   # å–®å…ƒæ¸¬è©¦
â”‚   â”œâ”€â”€ integration/            # æ•´åˆæ¸¬è©¦
â”‚   â”œâ”€â”€ e2e/                    # E2E æ¸¬è©¦
â”‚   â””â”€â”€ fixtures/               # æ¸¬è©¦è³‡æ–™
â”‚
â”œâ”€â”€ docs/                       # æª”æ¡ˆ
â”‚   â””â”€â”€ SPEC.md                 # æŠ€è¡“è¦æ ¼æ›¸
â”‚
â”œâ”€â”€ .github/                    # GitHub è¨­å®š
â”‚   â””â”€â”€ workflows/              # CI/CD
â”‚
â”œâ”€â”€ index.html
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ vite.config.ts
â”œâ”€â”€ tailwind.config.js
â”œâ”€â”€ tsup.config.ts              # å¥—ä»¶æ‰“åŒ…è¨­å®š (å¯é¸)
â””â”€â”€ README.md
```

### 9.2 ç·¨ç¢¼è¦ç¯„

#### TypeScript è¦ç¯„

```json
{
  "compilerOptions": {
    "target": "ES2020",
    "module": "ESNext",
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noImplicitReturns": true,
    "noFallthroughCasesInSwitch": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "resolveJsonModule": true,
    "isolatedModules": true,
    "moduleResolution": "bundler"
  }
}
```

#### ESLint è¦ç¯„

```javascript
module.exports = {
  extends: [
    'eslint:recommended',
    'plugin:@typescript-eslint/recommended',
    'plugin:react/recommended',
    'plugin:react-hooks/recommended',
    'prettier',
  ],
  rules: {
    '@typescript-eslint/no-explicit-any': 'error',
    '@typescript-eslint/explicit-function-return-type': 'warn',
    'react/react-in-jsx-scope': 'off',
    'react/prop-types': 'off',
  },
};
```

#### å‘½åæ…£ä¾‹

| å‹åˆ¥ | æ…£ä¾‹ | ç¯„ä¾‹ |
|------|------|------|
| å…ƒä»¶ | PascalCase | `UploadZone.tsx` |
| å‡½å¼ | camelCase | `calculateBill()` |
| å¸¸æ•¸ | UPPER_SNAKE_CASE | `MAX_FILE_SIZE` |
| å‹åˆ¥/ä»‹é¢ | PascalCase | `ElectricityBill` |
| ç§æœ‰æˆå“¡ | _camelCase | `_worker` |
| æª”æ¡ˆ | èˆ‡åŒ¯å‡ºåŒå | `OCRService.ts` |

#### Git æäº¤è¨Šæ¯è¦ç¯„

```
<type>(<scope>): <subject>

<body>

<footer>
```

| Type | èªªæ˜ |
|------|------|
| `feat` | æ–°åŠŸèƒ½ |
| `fix` | éŒ¯èª¤ä¿®å¾© |
| `refactor` | é‡æ§‹ |
| `docs` | æª”æ¡ˆ |
| `chore` | é›œé … |
| `test` | æ¸¬è©¦ |

ç¯„ä¾‹ï¼š
```
feat(ocr): add image preprocessing for better accuracy

Implement grayscale conversion and binarization to improve
OCR accuracy on low-quality images.

Closes #123
```

### 9.3 ç¬¬ä¸‰æ–¹å¥—ä»¶

#### å¿…è¦å¥—ä»¶

```json
{
  "dependencies": {
    "react": "^19.0.0",
    "react-dom": "^19.0.0",
    "zustand": "^4.5.0",
    "recharts": "^2.10.0",
    "tesseract.js": "^5.0.0",
    "date-fns": "^3.0.0"
  },
  "devDependencies": {
    "@types/react": "^19.0.0",
    "@types/react-dom": "^19.0.0",
    "@vitejs/plugin-react": "^4.2.0",
    "typescript": "^5.3.0",
    "vite": "^5.0.0",
    "vitest": "^1.0.0",
    "playwright": "^1.40.0",
    "eslint": "^9.0.0",
    "prettier": "^3.1.0",
    "tailwindcss": "^3.4.0"
  }
}
```

#### å¥—ä»¶ç”¨é€”èªªæ˜

| å¥—ä»¶ | ç”¨é€” |
|------|------|
| `tesseract.js` | OCR æ–‡å­—è­˜åˆ¥ |
| `zustand` | è¼•é‡ç´šç‹€æ…‹ç®¡ç† |
| `recharts` | åœ–è¡¨ç¹ªè£½ |
| `date-fns` | æ—¥æœŸè™•ç† |
| `vitest` | å–®å…ƒæ¸¬è©¦ |
| `playwright` | E2E æ¸¬è©¦ |

---

## 10. æ¸¬è©¦è¨ˆç•« (Testing Plan)

### 10.1 å–®å…ƒæ¸¬è©¦

#### æ¸¬è©¦æ¡†æ¶ï¼šVitest

#### è¦†è“‹ç‡ç›®æ¨™ï¼šâ‰¥ 80%

#### æ¸¬è©¦å°ˆæ¡ˆ

| æ¨¡çµ„ | æ¸¬è©¦å°ˆæ¡ˆ | æ¸¬è©¦æ¡ˆä¾‹æ•¸ |
|------|----------|------------|
| **OCR Service** | åˆå§‹åŒ–ã€åœ–ç‰‡é è™•ç†ã€è­˜åˆ¥ | 5+ |
| **Bill Parser** | æ¬„ä½æå–ã€é©—è­‰ | 10+ |
| **Rate Calculator** | å„æ–¹æ¡ˆè¨ˆç®—é‚è¼¯ | 20+ |
| **Comparison Service** | æ’åºã€å·®ç•°è¨ˆç®— | 5+ |
| **Utils** | æ—¥æœŸã€æ ¼å¼åŒ–ã€é©—è­‰ | 10+ |

#### æ¸¬è©¦ç¯„ä¾‹

```typescript
// tests/unit/calculation/RateCalculator.test.ts

describe('RateCalculator', () => {
  describe('éæ™‚é–“é›»åƒ¹è¨ˆç®—', () => {
    it('æ‡‰æ­£ç¢ºè¨ˆç®—ç´¯é€²è²»ç‡', () => {
      const input: CalculationInput = {
        consumption: 350,
        billingPeriod: {
          start: new Date('2025-01-01'),
          end: new Date('2025-01-31'),
        },
        voltageType: 'low_voltage',
        phase: 'single',
      };

      const result = calculator.calculateNonTOU(mockPlan, input, mockSeason);

      expect(result.charges.energy).toBeCloseTo(2345, 0);
    });

    it('æ‡‰æ­£ç¢ºè™•ç†è·¨æ®µç”¨é›»', () => {
      // æ¸¬è©¦ç”¨é›»åº¦æ•¸è·¨è¶Šå¤šå€‹ç´¯é€²æ®µ
    });
  });

  describe('å­£ç¯€åˆ¤æ–·', () => {
    it.each([
      ['2025-06-01', 'summer'],
      ['2025-09-30', 'summer'],
      ['2025-10-01', 'non_summer'],
      ['2025-05-31', 'non_summer'],
    ])('%s æ‡‰ç‚º %s', (date, expectedSeason) => {
      const season = calculator.determineSeason({
        start: new Date(date),
        end: new Date(date),
      });
      expect(season.name).toBe(expectedSeason);
    });
  });
});
```

### 10.2 æ•´åˆæ¸¬è©¦

#### æ¸¬è©¦å ´æ™¯

| å ´æ™¯ | æè¿° |
|------|------|
| **ä¸Šå‚³ â†’ OCR â†’ è§£æ** | å®Œæ•´çš„è³‡æ–™æå–æµç¨‹ |
| **è§£æ â†’ è¨ˆç®— â†’ æ¯”è¼ƒ** | å®Œæ•´çš„è¨ˆç®—æµç¨‹ |
| **æ‰‹å‹•è¼¸å…¥ â†’ è¨ˆç®—** | æ‰‹å‹•æ¨¡å¼æµç¨‹ |
| **éŒ¯èª¤è™•ç†** | å„ç¨®éŒ¯èª¤æƒ…å¢ƒè™•ç† |

#### æ¸¬è©¦ç¯„ä¾‹

```typescript
// tests/integration/bill-to-calculation.test.ts

describe('é›»è²»å–®åˆ°è¨ˆç®—çµæœæ•´åˆæ¸¬è©¦', () => {
  it('æ‡‰å¾é›»è²»å–®åœ–ç‰‡ç”¢ç”Ÿè¨ˆç®—çµæœ', async () => {
    const mockImage = new File([''], 'bill.jpg', { type: 'image/jpeg' });

    // 1. OCR è­˜åˆ¥
    const ocrResult = await ocrService.recognize(mockImage);

    // 2. è§£ææ¬„ä½
    const parsedBill = BillParser.parse(ocrResult);

    // 3. è¨ˆç®—
    const results = calculator.calculateAll(
      BillParser.toCalculationInput(parsedBill)
    );

    // é©—è­‰
    expect(results).toBeDefined();
    expect(results.length).toBeGreaterThan(0);
    expect(results[0].charges.total).toBeGreaterThan(0);
  });
});
```

### 10.3 E2E æ¸¬è©¦

#### æ¸¬è©¦æ¡†æ¶ï¼šPlaywright

#### æ¸¬è©¦æ¡ˆä¾‹

| æ¡ˆä¾‹ | æ­¥é©Ÿ |
|------|------|
| **å®Œæ•´æµç¨‹** | ä¸Šå‚³ â†’ ç¢ºèª â†’ æª¢è¦–çµæœ |
| **æ‰‹å‹•è¼¸å…¥** | æ‰‹å‹•æ¨¡å¼ â†’ è¼¸å…¥ â†’ æª¢è¦–çµæœ |
| **éŒ¯èª¤è™•ç†** | ä¸Šå‚³éåœ–ç‰‡ â†’ é©—è­‰éŒ¯èª¤è¨Šæ¯ |
| **éŸ¿æ‡‰å¼** | æ‰‹æ©Ÿ/å¹³æ¿/æ¡Œé¢ä½ˆå±€æª¢æŸ¥ |

#### æ¸¬è©¦ç¯„ä¾‹

```typescript
// tests/e2e/complete-flow.spec.ts

test('å®Œæ•´ä¸Šå‚³èˆ‡è¨ˆç®—æµç¨‹', async ({ page }) => {
  await page.goto('/');

  // 1. ä¸Šå‚³åœ–ç‰‡
  const fileInput = page.locator('input[type="file"]');
  await fileInput.setInputFile('tests/fixtures/bill-sample-1.jpg');

  // 2. ç­‰å¾… OCR å®Œæˆ
  await page.waitForSelector('[data-testid="ocr-result"]');

  // 3. ç¢ºèªä¸¦è¨ˆç®—
  await page.click('button:has-text("ç¢ºèªç„¡èª¤")');

  // 4. æª¢è¦–çµæœ
  await page.waitForSelector('[data-testid="plan-results"]');
  const planCards = page.locator('[data-testid="plan-card"]');
  await expect(planCards).toHaveCount(await getAvailablePlanCount());

  // 5. é©—è­‰æœ€çœéŒ¢æ–¹æ¡ˆ
  const cheapest = page.locator('[data-testid="plan-card"]:first-child');
  await expect(cheapest).toContainText('ğŸ¥‡');
});
```

### 10.4 OCR æº–ç¢ºåº¦æ¸¬è©¦

#### æ¸¬è©¦è³‡æ–™é›†

| å‹åˆ¥ | æ•¸é‡ | ä¾†æº |
|------|------|------|
| **çœŸå¯¦é›»è²»å–®** | 20+ | æ”¶é›†ä½¿ç”¨è€…é›»è²»å–® |
| **æ¨¡æ“¬é›»è²»å–®** | 10+ | è‡ªè¡Œç”¢ç”Ÿ |
| **ä½å“è³ªåœ–ç‰‡** | 10+ | æ•…æ„é™ä½å“è³ª |

#### æ¸¬è©¦æŒ‡æ¨™

| æŒ‡æ¨™ | ç›®æ¨™ |
|------|------|
| **æ•´é«”æº–ç¢ºç‡** | â‰¥ 80% |
| **é—œéµæ¬„ä½æº–ç¢ºç‡** | â‰¥ 90% |
| **è™•ç†æ™‚é–“** | < 20 ç§’ |

#### æ¸¬è©¦æ–¹æ³•

```typescript
// tests/ocr-accuracy/accuracy-test.ts

interface AccuracyTestResult {
  field: string;
  expected: string;
  actual: string;
  isCorrect: boolean;
  confidence: number;
}

async function testOCRAccuracy(
  testImages: TestImage[]
): Promise<AccuracyReport> {
  const results: AccuracyTestResult[] = [];

  for (const image of testImages) {
    const ocrResult = await ocrService.recognize(image.file);
    const parsed = BillParser.parse(ocrResult);

    for (const [field, expected] of Object.entries(image.expectedData)) {
      const actual = (parsed as any)[field];
      const isCorrect = actual === expected;

      results.push({
        field,
        expected,
        actual,
        isCorrect,
        confidence: ocrResult.confidence,
      });
    }
  }

  return calculateAccuracyMetrics(results);
}
```

---

## 11. éƒ¨ç½²ç­–ç•¥ (Deployment Strategy)

### 11.1 éƒ¨ç½²ç’°å¢ƒ

#### GitHub Pages è¨­å®š

```yaml
# .github/workflows/deploy.yml

name: Deploy to GitHub Pages

on:
  push:
    branches: [main]

permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Run tests
        run: npm test

      - name: Build
        run: npm run build
        env:
          VITE_BASE_URL: /taipower-tou-web/

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: ./dist

      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
```

#### Vite è¨­å®š

```typescript
// vite.config.ts

import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';

export default defineConfig({
  plugins: [react()],

  base: process.env.VITE_BASE_URL || '/',

  build: {
    outDir: 'dist',
    sourcemap: true,
    rollupOptions: {
      output: {
        manualChunks: {
          'tesseract': ['tesseract.js'],
          'recharts': ['recharts'],
        },
      },
    },
  },

  server: {
    port: 5173,
    open: true,
  },
});
```

### 11.2 CI/CD æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Push to  â”‚â”€â”€â”€â”€â–ºâ”‚  Lint &  â”‚â”€â”€â”€â”€â–ºâ”‚  Tests   â”‚â”€â”€â”€â”€â–ºâ”‚  Build   â”‚
â”‚  main    â”‚     â”‚  Type    â”‚     â”‚  Pass?   â”‚     â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                                              â”‚               â”‚
                                              â–¼               â–¼
                                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                         â”‚  Fail    â”‚    â”‚ Deploy   â”‚
                                         â”‚  Notify  â”‚    â”‚  to Pages â”‚
                                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                                                              â”‚
                                                              â–¼
                                                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                       â”‚  Live    â”‚
                                                       â”‚  URL     â”‚
                                                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 11.3 ç™¼ç‰ˆè¨ˆç•«

#### ç‰ˆæœ¬è¦åŠƒ

| ç‰ˆæœ¬ | åŠŸèƒ½ | é è¨ˆæ—¥æœŸ |
|------|------|----------|
| **v0.1.0** | MVPï¼šä¸Šå‚³ + OCR + 5 ç¨®æ–¹æ¡ˆ | Week 1-2 |
| **v0.2.0** | å®Œæ•´ 20 ç¨®æ–¹æ¡ˆ + åœ–è¡¨ | Week 3-4 |
| **v0.3.0** | æ‰‹å‹•è¼¸å…¥æ¨¡å¼ | Week 5 |
| **v0.4.0** | æ­·å²è¨˜éŒ„ + åˆ†äº« | Week 6 |
| **v1.0.0** | æ­£å¼ç‰ˆ | Week 7-8 |

#### ç™¼ç‰ˆæª¢æŸ¥æ¸…å–®

- [ ] æ‰€æœ‰æ¸¬è©¦é€é
- [ ] è¦†è“‹ç‡ â‰¥ 80%
- [ ] E2E æ¸¬è©¦é€é
- [ ] æ‰‹å‹•æ¸¬è©¦å®Œæˆ
- [ ] æª”æ¡ˆæ›´æ–°
- [ ] CHANGELOG æ›´æ–°
- [ ] Git tag å»ºç«‹

---

## 12. ç¶­è­·èˆ‡æ¼”é€² (Maintenance and Evolution)

### 12.1 ç¶­è­·è¨ˆç•«

#### å®šæœŸä»»å‹™

| ä»»å‹™ | é »ç‡ | èªªæ˜ |
|------|------|------|
| **ç›¸ä¾å¥—ä»¶æ›´æ–°** | æ¯é€± | Dependabot è‡ªå‹• PR |
| **è²»ç‡è³‡æ–™æ›´æ–°** | æ¯å­£ | è‡ºé›»èª¿æ•´è²»ç‡æ™‚ |
| **Bug ä¿®å¾©** | æŒçºŒ | æ ¹æ“šä½¿ç”¨è€…å›å ± |
| **æ•ˆèƒ½ç›£æ§** | æ¯æœˆ | Google Analytics |

#### ç·Šæ€¥ç¶­è­·

- OCR æº–ç¢ºç‡åš´é‡ä¸‹é™
- è¨ˆç®—çµæœéŒ¯èª¤
- ç¶²ç«™ç„¡æ³•è¨ªå•

### 12.2 ç‰ˆæœ¬æ¼”é€²è·¯å¾‘

#### v1.x - åŠŸèƒ½æ“´å……å¥—ä»¶

- æ”¯æ´æ›´å¤šé›»è²»å–®æ ¼å¼
- ç‡Ÿæ¥­ç”¨é›»æ–¹æ¡ˆ
- é«˜å£“ç”¨é›»æ–¹æ¡ˆ
- åŒ¯å‡º PDF å ±å‘Š

#### v2.x - æ™ºæ…§åŒ–

- AI é›»è²»å»ºè­°
- ç”¨é›»ç¿’æ…£åˆ†æ
- ç¯€èƒ½æç¤º
- ç¢³è¶³è·¡è¨ˆç®—

### 12.3 è²»ç‡æ›´æ–°æ©Ÿåˆ¶

#### è³‡æ–™ä¾†æº

1. è‡ºé›»å®˜æ–¹å…¬å‘Š
2. taipower-tou Python å¥—ä»¶æ›´æ–°

#### æ›´æ–°æµç¨‹

```mermaid
graph TD
    A[è‡ºé›»å…¬å‘Šè²»ç‡èª¿æ•´] --> B[æ›´æ–° plans.json]
    B --> C[åŸ·è¡Œæ¸¬è©¦]
    C --> D{æ¸¬è©¦é€é?}
    D -->|Yes| E[æäº¤ PR]
    D -->|No| B
    E --> F[Code Review]
    F --> G[åˆä½µä¸¦ç™¼ç‰ˆ]
    G --> H[æ›´æ–° CHANGELOG]
```

#### ç‰ˆæœ¬æ§åˆ¶

```typescript
// plans.json version field
{
  "version": "20251001",  // YYYYMMDD
  "definitions": { ... },
  "plans": [ ... ]
}
```

---

## 13. é¢¨éšªè©•ä¼° (Risk Assessment)

### 13.1 æŠ€è¡“é¢¨éšª

| é¢¨éšª | å½±éŸ¿ | å¯èƒ½æ€§ | ç·©è§£ç­–ç•¥ |
|------|------|--------|----------|
| **OCR æº–ç¢ºç‡ä¸è¶³** | é«˜ | ä¸­ | 1. åœ–ç‰‡é è™•ç†<br>2. æ‰‹å‹•ä¿®æ­£<br>3. æŒçºŒæœ€ä½³åŒ– |
| **Tesseract.js æ•ˆèƒ½** | ä¸­ | ä¸­ | 1. åœ–ç‰‡å£“ç¸®<br>2. Worker æœ€ä½³åŒ– |
| **è¨ˆç®—é‚è¼¯éŒ¯èª¤** | é«˜ | ä½ | 1. å®Œæ•´æ¸¬è©¦<br>2. èˆ‡ Python ç‰ˆæœ¬æ¯”å° |
| **ç€è¦½å™¨ç›¸å®¹æ€§** | ä¸­ | ä½ | 1. Polyfill<br>2. é™ç´šè™•ç† |
| **GitHub Pages é™åˆ¶** | ä½ | ä½ | 1. æª¢æŸ¥æª”æ¡ˆå¤§å°<br>2. ä½¿ç”¨ CDN |

### 13.2 æ¥­å‹™é¢¨éšª

| é¢¨éšª | å½±éŸ¿ | å¯èƒ½æ€§ | ç·©è§£ç­–ç•¥ |
|------|------|--------|----------|
| **è‡ºé›»è²»ç‡æ ¼å¼è®Šæ›´** | é«˜ | ä¸­ | 1. å½ˆæ€§è³‡æ–™çµæ§‹<br>2. å¿«é€Ÿæ›´æ–°æ©Ÿåˆ¶ |
| **ä½¿ç”¨è€…èª¤è§£çµæœ** | ä¸­ | ä¸­ | 1. æ¸…æ¥šèªªæ˜<br>2. å…è²¬å®£å‘Š |
| **é›»è²»å–®æ ¼å¼å¤šæ¨£** | é«˜ | é«˜ | 1. æ¨¡æ¿æ”¯æ´<br>2. æŒçºŒæ”¶é›†æ¨£æœ¬ |
| **è¨ˆç®—çµæœå·®ç•°** | é«˜ | ä¸­ | 1. é©—è­‰æ©Ÿåˆ¶<br>2. èª¤å·®èªªæ˜ |

### 13.3 é¢¨éšªç·©è§£ç­–ç•¥

#### OCR é¢¨éšªç·©è§£

```typescript
/**
 * ä¿¡å¿ƒåº¦é–¾å€¼æ©Ÿåˆ¶
 */
const CONFIDENCE_THRESHOLD = {
  HIGH: 0.9,    // é«˜ä¿¡å¿ƒåº¦ï¼šç›´æ¥ä½¿ç”¨
  MEDIUM: 0.7,  // ä¸­ä¿¡å¿ƒåº¦ï¼šæ¨™ç¤ºä½†å¯ä½¿ç”¨
  LOW: 0.5,     // ä½ä¿¡å¿ƒåº¦ï¼šè¦æ±‚ç¢ºèª
};

interface FieldWithConfidence<T> {
  value: T;
  confidence: number;
  status: 'auto' | 'review' | 'manual';
}

function processField<T>(
  field: string,
  value: T,
  confidence: number
): FieldWithConfidence<T> {
  if (confidence >= CONFIDENCE_THRESHOLD.HIGH) {
    return { value, confidence, status: 'auto' };
  } else if (confidence >= CONFIDENCE_THRESHOLD.MEDIUM) {
    return { value, confidence, status: 'review' };
  } else {
    return { value, confidence, status: 'manual' };
  }
}
```

#### è¨ˆç®—é©—è­‰

```typescript
/**
 * èˆ‡ Python ç‰ˆæœ¬æ¯”å°é©—è­‰
 */
async function validateCalculation(
  input: CalculationInput,
  typescriptResult: PlanCalculationResult
): Promise<boolean> {
  // å‘¼å« Python API æˆ–ä½¿ç”¨é å…ˆè¨ˆç®—çš„çµæœæ¯”å°
  const expected = await fetchExpectedResult(input);
  const difference = Math.abs(
    expected.charges.total - typescriptResult.charges.total
  );

  return difference < 1; // èª¤å·®å°æ–¼ 1 å…ƒ
}
```

---

## 14. é™„éŒ„ (Appendix)

### 14.1 è‡ºé›»è²»ç‡æ–¹æ¡ˆåˆ—è¡¨

| æ–¹æ¡ˆ ID | æ–¹æ¡ˆåç¨± | é©ç”¨ç‰©ä»¶ | æ™‚é–“é›»åƒ¹ |
|---------|----------|----------|----------|
| `residential_non_tou` | ä½å®¶ç”¨é›»ï¼ˆéæ™‚é–“é›»åƒ¹ï¼‰ | ä½å®…ä½¿ç”¨è€… | å¦ |
| `residential_simple_2_tier` | ä½å®¶ç”¨é›»ï¼ˆå…©æ®µå¼æ™‚é–“é›»åƒ¹ï¼‰ | ä½å®…ä½¿ç”¨è€… | æ˜¯ |
| `residential_simple_3_tier` | ä½å®¶ç”¨é›»ï¼ˆä¸‰æ®µå¼æ™‚é–“é›»åƒ¹ï¼‰ | ä½å®…ä½¿ç”¨è€… | æ˜¯ |
| `lighting_non_tou` | ç…§æ˜ç”¨é›»ï¼ˆéæ™‚é–“é›»åƒ¹ï¼‰ | è¡¨ç‡ˆä½¿ç”¨è€… | å¦ |
| `lighting_tou_2_tier` | ç…§æ˜ç”¨é›»ï¼ˆå…©æ®µå¼æ™‚é–“é›»åƒ¹ï¼‰ | è¡¨ç‡ˆä½¿ç”¨è€… | æ˜¯ |
| `lighting_tou_3_tier` | ç…§æ˜ç”¨é›»ï¼ˆä¸‰æ®µå¼æ™‚é–“é›»åƒ¹ï¼‰ | è¡¨ç‡ˆä½¿ç”¨è€… | æ˜¯ |

> å®Œæ•´ 20 ç¨®æ–¹æ¡ˆåˆ—è¡¨è«‹åƒè€ƒ `plans.json`

### 14.2 åƒè€ƒè³‡æ–™

#### å®˜æ–¹è³‡æº

| è³‡æº | é€£çµ |
|------|------|
| è‡ºé›»å®˜æ–¹ç¶²ç«™ | https://www.taipower.com.tw |
| è‡ºé›»æ™‚é–“é›»åƒ¹èªªæ˜ | https://www.taipower.com.tw/tc/page.aspx |
| taipower-tou Python å¥—ä»¶ | https://github.com/JUN-WEI-DING/taipower-tou |
| Tesseract.js æª”æ¡ˆ | https://github.com/naptha/tesseract.js |
| React æª”æ¡ˆ | https://react.dev |
| Vite æª”æ¡ˆ | https://vitejs.dev |

#### æŠ€è¡“æª”æ¡ˆ

| ä¸»é¡Œ | åƒè€ƒ |
|------|------|
| OCR æœ€ä½³å¯¦è¸ | Tesseract.js README |
| è²»ç‡è¨ˆç®—é‚è¼¯ | taipower-tou billing.py |
| éŸ¿æ‡‰å¼è¨­è¨ˆ | Tailwind CSS æª”æ¡ˆ |
| GitHub Pages éƒ¨ç½² | GitHub Pages Guide |

### 14.3 è©å½™è¡¨

| è©å½™ | è‹±æ–‡ | èªªæ˜ |
|------|------|------|
| **æ™‚é–“é›»åƒ¹** | Time-of-Use (TOU) | ä¾ç”¨é›»æ™‚é–“ä¸åŒæ”¶å–ä¸åŒè²»ç‡ |
| **ç´¯é€²è²»ç‡** | Tiered Rate | ä¾ç”¨é›»é‡åˆ†ç´šæ”¶å–ä¸åŒè²»ç‡ |
| **å°–å³°** | Peak On-Peak | ç”¨é›»é«˜å³°æ™‚æ®µï¼Œè²»ç‡æœ€é«˜ |
| **åŠå°–å³°** | Semi-Peak | æ¬¡é«˜å³°æ™‚æ®µ |
| **é›¢å³°** | Off-Peak | ç”¨é›»ä½è°·æ™‚æ®µï¼Œè²»ç‡æœ€ä½ |
| **åŸºæœ¬é›»è²»** | Basic Charge | å›ºå®šæ”¶å–çš„è²»ç”¨ï¼Œä¾å¥‘ç´„å®¹é‡è¨ˆç®— |
| **æµå‹•é›»è²»** | Energy Charge | ä¾ç”¨é›»åº¦æ•¸è¨ˆç®—çš„è²»ç”¨ |
| **å¥‘ç´„å®¹é‡** | Contract Capacity | ä½¿ç”¨è€…èˆ‡è‡ºé›»ç´„å®šçš„æœ€å¤§ç”¨é›»é‡ |
| **ä½å£“** | Low Voltage | 110V/220V é›»å£“ |
| **é«˜å£“** | High Voltage | 3300V ä»¥ä¸Šé›»å£“ |
| **OCR** | Optical Character Recognition | å…‰å­¸å­—å…ƒè­˜åˆ¥ |
| **ä¿¡å¿ƒåº¦** | Confidence | OCR è­˜åˆ¥çµæœçš„å¯ä¿¡ç¨‹åº¦ |

---

**æ–‡ä»¶çµæŸ**

---

## è®Šæ›´è¨˜éŒ„ (Changelog)

| ç‰ˆæœ¬ | æ—¥æœŸ | è®Šæ›´å…§å®¹ | ä½œè€… |
|------|------|----------|------|
| 1.0.0 | 2025-02-21 | åˆå§‹ç‰ˆæœ¬ | Claude |

---

**æ ¸å‡†**

| è§’è‰² | å§“å | ç°½å | æ—¥æœŸ |
|------|------|------|------|
| å°ˆæ¡ˆç¶“ç† | | | |
| æŠ€è¡“ä¸»ç®¡ | | | |
| é–‹ç™¼ä¸»ç®¡ | | | |
